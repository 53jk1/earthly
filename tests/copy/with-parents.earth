VERSION 0.6

FROM alpine:3.13

WORKDIR /test

all:
    BUILD +copy-files-single-parent
    BUILD +copy-dir-single-parent
    BUILD +copy-files-multi-parent
    BUILD +copy-dir-multi-parent

copy-files-single-parent:
    COPY ../test1 test1/
    RUN find test1 | sort | tee ./actual
    RUN echo "test1
test1/foo1" >./expected
    RUN diff -b ./actual ./expected

copy-dir-single-parent:
    COPY --dir ../test1 ./
    RUN find test1 | sort | tee ./actual
    RUN echo "test1
test1/foo1" >./expected
    RUN diff -b ./actual ./expected

copy-files-multi-parent:
    COPY ../test1 test1/
    COPY ../../opt/test2 test2/
    RUN find test1 test2 | sort | tee ./actual
    RUN echo "test1
test1/foo1
test2
test2/foo2" >./expected
    RUN diff -b ./actual ./expected

copy-dir-multi-parent:
    COPY --dir ../test1 ./
    COPY --dir ../../opt/test2 ./
    RUN find test1 test2 | sort | tee ./actual
    RUN echo "test1
test1/foo1
test2
test2/foo2" >./expected
    RUN diff -b ./actual ./expected
